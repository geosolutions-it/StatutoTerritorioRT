(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"./MapStore2/web/client/components/TOC/fragments/settings/ThematicLayer.jsx":function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=n("./node_modules/prop-types/index.js"),h=n("./node_modules/react/index.js"),g=n("./node_modules/react-bootstrap/es/index.js"),b=g.ControlLabel,C=g.FormGroup,v=g.Row,E=g.Col,S=g.Grid,x=g.Alert,j=g.Checkbox,O=n("./node_modules/lodash/lodash.js"),w=O.isObject,P=O.isEqual,k=n("./node_modules/react-widgets/lib/index.js").Combobox,_=n("./node_modules/object-assign/index.js"),I=n("./MapStore2/web/client/components/I18N/Message.jsx"),T=n("./MapStore2/web/client/components/misc/switch/SwitchPanel.jsx"),L=n("./MapStore2/web/client/components/style/ColorRangeSelector.jsx"),R=n("./node_modules/react-codemirror2/index.js").Controlled,N=n("./node_modules/react-widgets/lib/index.js").NumberPicker;n("./node_modules/codemirror/lib/codemirror.css"),n("./node_modules/codemirror/mode/javascript/javascript.js");var M=n("./MapStore2/web/client/utils/LocaleUtils.js").getMessageById,z=n("./node_modules/tinycolor2/tinycolor.js"),D=n("./MapStore2/web/client/components/style/ColorPicker.jsx").default,V=n("./MapStore2/web/client/components/misc/LoadingView.jsx"),U=n("./MapStore2/web/client/components/style/ThemaClassesEditor.jsx"),A={current:void 0,unconfigured:void 0,applied:void 0},F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(g,e);var t,n,r,o,y=(t=g,function(){var e,n=f(t);if(m()){var r=f(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return p(this,e)});function g(){var e;l(this,g);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return d(u(e=y.call.apply(y,[this].concat(n))),"getCurrentThema",(function(t){var n=e.props.getThematicParameters(t.params||[]).reduce((function(e,t){return _(e,d({},t.field,t.defaultValue))}),{});return _({},e.props.initialParams,{attribute:t.attribute||""},n,t.applied)})),d(u(e),"getClassification",(function(){return e.props.layer.thematic.current.classification||e.props.classification||[]})),d(u(e),"getValue",(function(e){return!w(e)&&e||e.value||e.name})),d(u(e),"getColors",(function(){var t=e.props.getColors(e.props.colors,e.props.layer,e.props.colorSamples);return t?t.map((function(e){var t=e.name,n=i(e,["name"]);return a({label:"global.colors.".concat(t),name:t},n)})):[]})),d(u(e),"renderError",(function(t,n){return h.createElement(x,{bsStyle:"danger"},h.createElement(I,{msgId:"toc.thematic."+n,msgParams:{message:e.localizedItem(t.message,"")}}))})),d(u(e),"renderInputError",(function(t){var n=e.props.invalidInputs[t];return n?h.createElement(x,{bsStyle:"danger"},h.createElement(I,{msgId:n.message,msgParams:n.params||{}})):null})),d(u(e),"renderThemaPanel",(function(t){return h.createElement(v,null,h.createElement(E,{xs:12},h.createElement(T,{expanded:!0,locked:!0,title:e.localizedItem("toc.thematic.data_panel",""),buttons:[{glyph:"cog",tooltip:e.localizedItem("toc.thematic.go_to_cfg",""),visible:e.props.canEditThematic,onClick:e.toggleCfg}]},h.createElement(S,{fluid:!0},h.createElement(v,null,e.props.layer.thematic.params&&e.props.layer.thematic.params.length?e.renderParams(t):null,h.createElement(E,{xs:12},h.createElement(C,null,h.createElement(E,{xs:6},h.createElement(b,null,h.createElement(I,{msgId:"toc.thematic.classification_field"}))),h.createElement(E,{xs:6},h.createElement(k,{disabled:e.hasCustomClassification(),busy:e.props.fieldsLoading.status,data:e.props.fields,textField:"name",valueField:"name",value:t.field,onChange:function(t){return e.updateStyle("field",e.getValue(t))}}))))),h.createElement(v,null,h.createElement(E,{xs:12},e.props.fieldsLoading.error?e.renderError(e.props.fieldsLoading.error,"fields_error"):null))))),",",h.createElement(E,{xs:12},h.createElement(T,{expanded:!0,locked:!0,title:h.createElement(I,{msgId:"toc.thematic.classify"}),buttons:[{glyph:"trash",tooltip:e.localizedItem("toc.thematic.remove",""),onClick:e.removeStyle,visible:e.props.enableRemoveStyle&&e.props.hasThematicStyle(e.props.layer)},{glyph:"undo",tooltip:e.localizedItem("toc.thematic.restore",""),onClick:e.restoreStyle,visible:e.hasCustomClassification()},{glyph:"ok",disabled:!e.props.applyEnabled||Object.keys(e.props.invalidInputs).length>0,tooltip:e.localizedItem("toc.thematic.apply",""),onClick:function(){return e.applyStyle(e.props.layer)}}]},h.createElement(S,{fluid:!0},h.createElement(v,null,h.createElement(E,{xs:12},h.createElement(C,null,h.createElement(E,{xs:6},h.createElement(b,null,h.createElement(I,{msgId:"toc.thematic.classification_method"}))),h.createElement(E,{xs:6},h.createElement(k,{disabled:e.hasCustomClassification(),data:e.props.methods,textField:e.localizedItem,defaultValue:t.method,onSelect:function(t){return e.updateStyle("method",e.getValue(t))}})))),h.createElement(E,{xs:12},h.createElement(C,null,h.createElement(E,{xs:6},h.createElement(b,null,h.createElement(I,{msgId:"toc.thematic.classification_intervals"}))),h.createElement(E,{xs:6},h.createElement(N,{disabled:e.hasCustomClassification(),value:t.intervals,onChange:function(t){e.updateStyle("intervals",e.constrainIntervals(e.getValue(t)))}}))),e.renderInputError("intervals")),h.createElement(E,{xs:12},h.createElement(C,null,h.createElement(E,{xs:6},h.createElement(b,null,h.createElement(I,{msgId:"toc.thematic.classification_colors"}))),h.createElement(E,{xs:6},h.createElement(L,{items:e.getColors(),rampFunction:e.createRamp,value:{name:t.ramp},disabled:e.hasCustomClassification(),samples:5,onChange:function(t){e.updateStyle("ramp",e.getValue(t))}})))),"LineString"!==e.props.geometryType?h.createElement(E,{xs:12},h.createElement(C,null,h.createElement(E,{xs:6},h.createElement(b,null,h.createElement(I,{msgId:"toc.thematic.classification_stroke"}))),h.createElement(E,{xs:1},h.createElement(j,{checked:t.strokeOn,onChange:function(t){return e.updateStyle("strokeOn",t.target.checked)}})),h.createElement(E,{xs:2},h.createElement(D,{key:"strokeColor",pickerProps:{disableAlpha:!0},disabled:!t.strokeOn,text:t.strokeColor,value:a({},z(t.strokeColor).toRgb(),{a:100}),onChangeColor:e.updateStrokeColor})),h.createElement(E,{xs:3},h.createElement(N,{key:"strokeWeight",disabled:!t.strokeOn,format:"- ###.###",value:t.strokeWeight,onChange:e.updateStrokeWeight})))):null),h.createElement(v,null,h.createElement(E,{xs:12},e.props.classificationLoading.status?h.createElement(V,{width:e.props.loaderSize,height:e.props.loaderSize}):null,e.renderInputError("classification"),h.createElement(U,{className:e.props.classificationLoading.status?"loading":"",classification:e.getClassification(),onUpdateClasses:e.updateClassification}),e.props.classificationLoading.error?e.renderError(e.props.classificationLoading.error,"classification_error"):null))))))})),d(u(e),"renderConfigurationEditor",(function(){var t=e.isConfigurationValid();return h.createElement(v,null,h.createElement(E,{xs:12},h.createElement(T,{expanded:!0,locked:!0,title:h.createElement(I,{msgId:"toc.thematic.configuration"}),buttons:[{glyph:"arrow-right",tooltip:e.localizedItem("toc.thematic.go_to_thema",""),onClick:function(){return e.applyCfg(e.props.adminCfg.current)},visible:t},{glyph:"exclamation-mark",tooltip:e.localizedItem("toc.thematic.cfgError",""),glyphClassName:"text-danger",visible:!t}]},h.createElement(R,{ref:function(t){e.cfgEditor=t},style:{width:"500px"},key:"code-mirror",value:e.props.adminCfg.current,onBeforeChange:e.updateCfg,options:{theme:"midnight",mode:{name:"javascript"},lineNumbers:!0}}))))})),d(u(e),"renderParams",(function(t){return e.props.getThematicParameters(e.props.layer.thematic.params).map((function(n){return h.createElement(E,{xs:12},h.createElement(C,null,h.createElement(E,{xs:6},h.createElement(b,null,e.localizedItem(n.title,""))),h.createElement(E,{xs:6},h.createElement(k,{data:n.values,textField:function(t){return e.localizedItem(t.name,"")},valueField:"value",value:t[n.field],onSelect:function(t){return e.updateStyle(n.field,e.getValue(t))}}))))}))})),d(u(e),"constrainIntervals",(function(t){return isNaN(t)||t<2||t>e.props.maxClasses?e.props.onInvalidInput("intervals","toc.thematic.interval_limit",{min:2,max:e.props.maxClasses}):e.props.onValidInput("intervals"),t})),d(u(e),"checkInitialStyle",(function(t){var n=t.layer.thematic;!t.hasThematicStyle(t.layer)&&n&&!n.unconfigured&&n.current&&n.current.field&&t.classification&&t.classification.length&&e.applyStyle(t.layer)})),d(u(e),"hasConfiguration",(function(){return e.props.layer.thematic&&!e.props.layer.thematic.unconfigured})),d(u(e),"updateStrokeColor",(function(t){t&&e.updateStyle("strokeColor",z(t).toHexString())})),d(u(e),"updateStrokeWeight",(function(t){e.updateStyle("strokeWeight",t)})),d(u(e),"hasCustomClassification",(function(){return!!e.props.layer.thematic.current.classification})),d(u(e),"removeStyle",(function(){var t=e.props.layer,n=e.props.removeThematicStyle(t.params);e.props.onChange({params:n,thematic:_({},t.thematic,{applied:_({},t.thematic.current)})})})),d(u(e),"updateClassification",(function(t){e.props.onChange("thematic",_({},e.props.layer.thematic,{current:_({},e.props.layer.thematic.current,{classification:t})})),e.validClassification(t)?e.props.onValidInput("classification"):e.props.onInvalidInput("classification","toc.thematic.invalid_classes"),e.props.onDirtyStyle()})),d(u(e),"validClassification",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return!e.reduce((function(e,t){return e||t.max<t.min}),!1)})),d(u(e),"createRamp",(function(e){return e.colors})),d(u(e),"isConfigurationValid",(function(){try{return JSON.parse(e.props.adminCfg.current),!0}catch(e){return!1}})),d(u(e),"applyCfg",(function(t){try{var n=JSON.parse(t),r=_({},n,{current:e.getCurrentThema(n),unconfigured:!1});e.props.onChange("thematic",r),e.props.onSwitchLayer(_({},e.props.layer,{thematic:r})),e.props.onChangeConfiguration(e.props.layer,!1,t)}catch(n){e.props.onChangeConfiguration(e.props.layer,!0,t,n.message)}})),d(u(e),"updateCfg",(function(t,n,r){e.props.onChangeConfiguration(e.props.layer,!0,r)})),d(u(e),"toggleCfg",(function(){e.props.onChangeConfiguration(e.props.layer,!e.props.adminCfg.open,e.props.adminCfg.current)})),d(u(e),"localizedItem",(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"toc.thematic.values.";return M(e.context.messages,n+t)})),d(u(e),"switchLayer",(function(t){if(t.thematic){var n=e.getCurrentThema(t.thematic);e.props.onChange("thematic",_({},t.thematic,{current:n}))}e.props.onSwitchLayer(t)})),d(u(e),"restoreStyle",(function(){var t=_({},e.props.layer,{thematic:_({},e.props.layer.thematic,{current:_({},e.props.layer.thematic.current,{classification:null})})});e.updateStyle("classification",null,!0),e.applyStyle(t)})),d(u(e),"applyStyle",(function(t){var n=_({},t.params,e.props.getStyleParameters(t,t.thematic.current));e.props.onChange({params:n,thematic:_({},t.thematic,{applied:_({},t.thematic.current)})}),e.props.onApplyStyle()})),d(u(e),"needsToUpdateClassification",(function(t){return!e.hasCustomClassification()&&-1===["strokeOn","strokeColor","strokeWeight"].indexOf(t)||"classification"===t})),d(u(e),"updateStyle",(function(t,n,r){var o=e.props.layer,a=_({},o.thematic.current,d({},t,n)),i=_({},o.thematic,{current:a});if(e.props.onChange("thematic",i),e.needsToUpdateClassification(t)){var l=_({},e.props.getMetadataParameters(o,a));e.props.onClassify(_({},o,{thematic:i}),l)}r||e.props.onDirtyStyle()})),e}return n=g,(r=[{key:"UNSAFE_componentWillMount",value:function(){this.props.layer&&(this.props.onChangeConfiguration(this.props.layer,!1,JSON.stringify(_({},this.props.layer.thematic,A),null,4)),this.hasConfiguration()?this.switchLayer(this.props.layer):this.applyCfg("{}"),this.checkInitialStyle(this.props))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){if(!e.layer||this.props.layer&&e.layer.id===this.props.layer.id||this.switchLayer(e.layer),e.fields&&e.fields.length&&!P(e.fields,this.props.fields)){var t=e.layer.thematic.applied&&e.layer.thematic.applied.field||e.fields[0].name;this.updateStyle("field",t,!0)}this.checkInitialStyle(e)}},{key:"render",value:function(){var e=this.props.layer&&this.props.layer.thematic&&this.props.layer.thematic.current;return h.createElement(S,{fluid:!0,className:"thematic_layer"},this.props.canEditThematic&&this.props.adminCfg.open?this.renderConfigurationEditor():null,this.hasConfiguration()&&!this.props.adminCfg.open&&e?this.renderThemaPanel(e):null)}}])&&c(n.prototype,r),o&&c(n,o),g}(h.Component);d(F,"propTypes",{layer:y.object,onChange:y.func,onChangeConfiguration:y.func,onSwitchLayer:y.func,onApplyStyle:y.func,onClassify:y.func,onDirtyStyle:y.func,onInvalidInput:y.func,onValidInput:y.func,getStyleParameters:y.func,getThematicParameters:y.func,getMetadataParameters:y.func,getColors:y.func,hasThematicStyle:y.func,removeThematicStyle:y.func,colors:y.array,fields:y.array,fieldsLoading:y.object,classification:y.array,classificationLoading:y.object,initialParams:y.object,methods:y.array,canEditThematic:y.bool,colorSamples:y.number,maxClasses:y.number,loaderSize:y.number,adminCfg:y.object,enableRemoveStyle:y.bool,applyEnabled:y.bool,invalidInputs:y.object,geometryType:y.string}),d(F,"contextTypes",{messages:y.object}),d(F,"defaultProps",{onChange:function(){},onChangeConfiguration:function(){},onInvalidInput:function(){},onValidInput:function(){},getStyleParameters:function(){},getThematicParameters:function(e){return e},getMetadataParameters:function(){},hasThematicStyle:function(){},removeThematicStyle:function(){},getColors:function(e){return e},onSwitchLayer:function(){},onClassify:function(){},onApplyStyle:function(){},onDirtyStyle:function(){},canEditThematic:!1,fieldsLoading:{status:!1,error:null},classificationLoading:{status:!1,error:null},initialParams:{},colorSamples:5,maxClasses:15,loaderSize:100,adminCfg:{open:!1,current:null,error:null},enableRemoveStyle:!1,applyEnabled:!1,invalidInputs:{},geometryType:"Polygon"}),e.exports=F},"./MapStore2/web/client/components/style/ThemaClassesEditor.jsx":function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?p(e):t}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=n("./node_modules/react/index.js"),y=n("./node_modules/prop-types/index.js"),h=n("./node_modules/react-bootstrap/es/index.js"),g=h.Grid,b=h.Row,C=h.Col,v=h.FormGroup,E=n("./MapStore2/web/client/components/style/ColorPicker.jsx").default;n("./node_modules/react-widgets/lib/localizers/simple-number.js")();var S=n("./node_modules/react-widgets/lib/index.js").NumberPicker,x=n("./node_modules/tinycolor2/tinycolor.js"),j=n("./node_modules/object-assign/index.js"),O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(h,e);var t,n,r,o,y=(t=h,function(){var e,n=m(t);if(u()){var r=m(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return s(this,e)});function h(){var e;i(this,h);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return f(p(e=y.call.apply(y,[this].concat(n))),"renderClasses",(function(){return e.props.classification.map((function(t,n){return d.createElement(b,null,d.createElement(v,null,d.createElement(C,{xs:"4"},d.createElement(E,{key:t.color,pickerProps:{disableAlpha:!0},text:t.color,value:a({},x(t.color).toRgb(),{a:100}),onChangeColor:function(t){return e.updateColor(n,t)}})),d.createElement(C,{xs:"4"},d.createElement(S,{format:"- ###.###",value:t.min,onChange:function(t){return e.updateMin(n,t)}})),d.createElement(C,{xs:"4"},d.createElement(S,{format:"- ###.###",value:t.max,precision:3,onChange:function(t){return e.updateMax(n,t)}}))))}))})),f(p(e),"updateColor",(function(t,n){if(n){var r=e.props.classification.map((function(e,r){return r===t?j({},e,{color:x(n).toHexString()}):e}));e.props.onUpdateClasses(r)}})),f(p(e),"updateMin",(function(t,n){if(!isNaN(n)){var r=e.props.classification.map((function(e,r){return r===t?j({},e,{min:n}):r===t-1?j({},e,{max:n}):e}));e.props.onUpdateClasses(r,!0)}})),f(p(e),"updateMax",(function(t,n){if(!isNaN(n)){var r=e.props.classification.map((function(e,r){return r===t?j({},e,{max:n}):r===t+1?j({},e,{min:n}):e}));e.props.onUpdateClasses(r)}})),e}return n=h,(r=[{key:"render",value:function(){return d.createElement("div",{className:"thema-classes-editor "+this.props.className},d.createElement(g,{fluid:!0},d.createElement(b,null,this.renderClasses())))}}])&&l(n.prototype,r),o&&l(n,o),h}(d.Component);f(O,"propTypes",{classification:y.array,onUpdateClasses:y.func,className:y.string}),f(O,"defaultProps",{classification:[],onUpdateClasses:function(){},className:""}),e.exports=O}}]);